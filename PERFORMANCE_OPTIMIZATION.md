# Оптимизация производительности

## Проблема: долгие запросы

Если запросы занимают более 10-30 секунд, это может быть связано с:

1. **Медленным RPC endpoint** - публичные RPC часто медленные
2. **Большим количеством токенов** - обработка 10,000+ аккаунтов занимает время
3. **Retry логикой** - если запросы падают, повторные попытки увеличивают время

## Что было добавлено

### 1. Таймауты для RPC запросов

Каждый RPC запрос теперь имеет таймаут (по умолчанию 30 секунд). Если запрос не завершается в течение таймаута, он прерывается и делается повторная попытка.

### 2. Детальное логирование времени

Теперь логируется:
- Время выполнения каждого RPC запроса
- Время обработки данных
- Общее время выполнения
- Предупреждения при долгих запросах (>10 секунд)

### 3. Предупреждения о производительности

Если запрос занимает:
- **>5 секунд** - предупреждение в логах
- **>10 секунд** - детальное логирование с разбивкой по этапам

## Рекомендации

### Используйте быстрый RPC endpoint

**Публичные RPC (медленные):**
- `https://api.mainnet-beta.solana.com` - часто медленный, ограничения

**Приватные RPC (быстрые):**
- Helius: `https://mainnet.helius-rpc.com/?api-key=YOUR_KEY`
- QuickNode: `https://your-endpoint.solana-mainnet.quiknode.pro/YOUR_KEY/`
- Alchemy: `https://solana-mainnet.g.alchemy.com/v2/YOUR_KEY`

### Настройка таймаутов

```bash
# Уменьшить таймаут для быстрых RPC
--timeout 15

# Увеличить таймаут для медленных RPC
--timeout 60
```

### Настройка retry

```bash
# Уменьшить количество повторных попыток для быстрых RPC
--max-retries 2

# Увеличить для нестабильных RPC
--max-retries 5
```

## Примеры логов

### Нормальный запрос (<5 секунд)
```
Successfully retrieved 12876 accounts in 1.10s
```

### Медленный запрос (>10 секунд)
```
WARN: RPC fetch took 25.30s - consider using a faster RPC endpoint
WARN: Slow request detected: total=31.36s, fetch=25.30s, extract=0.05s, accounts=12876
```

### С повторными попытками
```
RPC request failed (attempt 1/3): Connection timeout
Retrying in 1s...
Successfully retrieved 12876 accounts after 1 retries (total time: 5.20s)
```

## Мониторинг производительности

Следите за логами на предмет:
- Предупреждений о долгих запросах
- Повторных попыток (retry)
- Таймаутов

Если видите частые предупреждения, рассмотрите:
1. Смену RPC endpoint на более быстрый
2. Увеличение таймаутов
3. Уменьшение интервала опроса

